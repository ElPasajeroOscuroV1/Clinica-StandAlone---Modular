<div class="medical-history-container">
  <div class="medical-history-header">
    <div class="header-content">
      <div class="header-icon">üìã</div>
      <div class="header-text">
        <h1>Historiales Cl√≠nicos</h1>
        <p>Gesti√≥n completa de historias m√©dicas de pacientes</p>
      </div>
    </div>
  </div>

  <div class="content-section">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Cargando historiales cl√≠nicos...</p>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="message-alert success-alert">
      <div class="alert-icon">‚úÖ</div>
      <div class="alert-content">
        <strong>¬°√âxito!</strong>
        <p>{{ successMessage }}</p>
      </div>
      <button type="button" class="alert-close" (click)="successMessage = null" aria-label="Cerrar">
        ‚úï
      </button>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="message-alert error-alert">
      <div class="alert-icon">‚ö†Ô∏è</div>
      <div class="alert-content">
        <strong>Error</strong>
        <p>{{ errorMessage }}</p>
      </div>
    </div>

    <!-- Medical Histories Table -->
    <div *ngIf="!loading && histories.length > 0" class="table-section">
      <div class="table-header">
        <h3>Registros de Historias Cl√≠nicas</h3>
        <div class="table-stats">
          <span class="stat-item">
            <i class="icon-records"></i>
            {{ histories.length }} registros
          </span>
        </div>
      </div>

      <div class="table-responsive">
        <table class="medical-history-table">
          <thead>
            <tr>
              <th><i class="icon-id"></i> ID</th>
              <th><i class="icon-user"></i> Paciente</th>
              <th><i class="icon-mail"></i> Email</th>
              <th><i class="icon-card"></i> CI</th>
              <th><i class="icon-reason"></i> Motivo de Consulta</th>
              <th><i class="icon-allergy"></i> Alergias</th>
              <th><i class="icon-calendar"></i> Fecha de Creaci√≥n</th>
              <th><i class="icon-actions"></i> Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let h of histories; let i = index" [class.even-row]="i % 2 === 0">
              <td class="id-cell">{{ h.id }}</td>
              <td class="patient-cell">
                <div class="patient-info">
                  <strong>{{ h.patient.name }}</strong>
                </div>
              </td>
              <td class="email-cell">{{ h.patient.email }}</td>
              <td class="ci-cell">
                <span class="ci-badge">{{ h.patient.ci }}</span>
              </td>
              <td class="reason-cell">
                <div class="reason-text" [title]="h.consultation_reason">
                  {{ h.consultation_reason }}
                </div>
              </td>
              <td class="allergies-cell">
                <span class="allergy-badge" *ngIf="h.allergies; else noAllergies">
                  {{ h.allergies }}
                </span>
                <ng-template #noAllergies>
                  <span class="no-allergies">Sin alergias registradas</span>
                </ng-template>
              </td>
              <td class="date-cell">
                <div class="date-info">
                  <span class="date">{{ h.created_at | date:'dd/MM/yyyy' }}</span>
                  <small class="time">{{ h.created_at | date:'HH:mm' }}</small>
                </div>
              </td>
              <td class="actions-cell">
                <div class="action-buttons">
                  <button class="btn btn-primary btn-sm" (click)="openHistoryModal(h)" title="Ver y editar historial">
                    <i class="icon-view"></i> Ver / Editar
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && histories.length === 0" class="empty-state">
      <div class="empty-icon">üìÑ</div>
      <h3>No hay historiales cl√≠nicos</h3>
      <p>A√∫n no se han registrado historias cl√≠nicas en el sistema.</p>
      <div class="empty-actions">
        <small>Los historiales se crear√°n autom√°ticamente cuando se registren atenciones m√©dicas.</small>
      </div>
    </div>
  </div>
</div>
