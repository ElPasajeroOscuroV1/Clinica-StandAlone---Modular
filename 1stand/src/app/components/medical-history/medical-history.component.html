<div class="container mt-3">
  <h2>Historiales Clínicos</h2>

  <div *ngIf="loading" class="alert alert-info">Cargando historiales...</div>
  
  <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
    {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = null" aria-label="Close"></button>
  </div>

  <table class="table table-striped" *ngIf="!loading && histories.length > 0">
    <thead>
      <tr>
        <th>ID</th>
        <th>Paciente</th>
        <th>Email</th>
        <th>CI</th>
        <th>Motivo de Consulta</th>
        <th>Alergias</th>
        <th>Fecha de Creación</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let h of histories">
        <td>{{ h.id }}</td>
        <td>{{ h.patient.name }}</td>
        <td>{{ h.patient.email }}</td>
        <td>{{ h.patient.ci }}</td>
        <td>{{ h.consultation_reason }}</td>
        <td>{{ h.allergies }}</td>
        <td>{{ h.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
        <td>
          <button class="btn btn-sm btn-primary" (click)="openHistoryModal(h)">
            Ver / Editar
          </button>
          <button class="btn btn-secondary" (click)="exportHistoryHTMLToPDF(h)">
            Exportar PDF Visual
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && histories.length === 0" class="alert alert-warning">
    No hay historiales clínicos registrados.
  </div>
</div>
