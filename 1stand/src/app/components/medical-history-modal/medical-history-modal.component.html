<form [formGroup]="medicalHistoryForm" (ngSubmit)="saveMedicalHistory()">

<div id="modalContent" class="p-3" style="font-family: Arial, sans-serif; color: #333;">

  <!-- Cabecera -->
  <div class="modal-header" style="border-bottom: 2px solid #0d6efd;">
    <h4 class="modal-title">Historial Clínico del Paciente: {{ patientData?.name }}</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
  </div>

  <!-- Selección de historial -->
  <div class="mb-3 mt-2">
    <label for="historySelect" class="form-label"><strong>Seleccionar versión del historial:</strong></label>
    <select id="historySelect" class="form-select" (change)="onHistoryChange($event)">
      <option *ngFor="let h of patientHistories" [value]="h.id" [selected]="h.id === selectedHistory?.id">
        {{ h.created_at | date:'short' }} - {{ h.consultation_reason }}
      </option>
    </select>
  </div>

  <!-- Cuerpo -->
  <div class="modal-body border p-3 rounded" style="background-color: #f8f9fa;">
    <!-- Datos personales -->
    <h5 style="color:#0d6efd; border-bottom:1px solid #0d6efd;">Datos Personales</h5>
    <div class="row mb-3">
      <div class="col-md-4">
        <p><strong>Nombre:</strong> {{ patientData?.name }}</p>
      </div>
      <div class="col-md-4">
        <p><strong>Email:</strong> {{ patientData?.email }}</p>
      </div>
      <div class="col-md-4">
        <p><strong>CI:</strong> {{ patientData?.ci }}</p>
      </div>
    </div>

    <!-- Antecedentes -->
    <h5 style="color:#0d6efd; border-bottom:1px solid #0d6efd;">Antecedentes</h5>
    <div class="mb-2">
      <label><strong>Médicos:</strong></label>
      <textarea class="form-control" formControlName="medicalBackground"></textarea>
    </div>
    <div class="mb-2">
      <label><strong>Odontológicos:</strong></label>
      <textarea class="form-control" formControlName="dentalBackground"></textarea>
    </div>


    <!-- Motivo de consulta -->
    <h5 style="color:#0d6efd; border-bottom:1px solid #0d6efd;">Motivo de la Consulta</h5>
    <input type="text" class="form-control" formControlName="consultationReason" />


    <!-- Exámenes clínicos -->
    <h5 style="color:#0d6efd; border-bottom:1px solid #0d6efd;">Resultados de Exámenes Clínicos</h5>
    <div class="mb-2">
      <label><strong>Extraoral:</strong></label>
      <textarea class="form-control" formControlName="extraoralExam"></textarea>
    </div>
    <div class="mb-2">
      <label><strong>Intraoral:</strong></label>
      <textarea class="form-control" formControlName="intraoralExam"></textarea>
    </div>


    <!-- Odontograma -->
    <h5 style="color:#0d6efd; border-bottom:1px solid #0d6efd;">Odontograma</h5>
    <div class="odontogram-placeholder border p-3 mb-3 text-center text-muted">
      <p>Aquí se visualizará el odontograma.</p>
    </div>

    <!-- Información adicional -->
    <h5 style="color:#0d6efd; border-bottom:1px solid #0d6efd;">Información Adicional</h5>
    <div class="mb-2">
      <label><strong>Tratamientos Realizados:</strong></label>
      <textarea class="form-control" formControlName="treatmentsPerformed"></textarea>
    </div>
    <div class="mb-2">
      <label><strong>Medicamentos Actuales:</strong></label>
      <textarea class="form-control" formControlName="currentMedications"></textarea>
    </div>
    <div class="mb-2">
      <label><strong>Alergias:</strong></label>
      <textarea class="form-control" formControlName="allergies"></textarea>
    </div>
    <div class="mb-2">
      <label><strong>Hábitos Bucales Relevantes:</strong></label>
      <textarea class="form-control" formControlName="relevantOralHabits"></textarea>
    </div>


  </div>
</div>

<!-- Footer -->
<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
  <button class="btn btn-success" (click)="exportModalToPDF()">Exportar a PDF</button>
  <button type="submit" class="btn btn-primary" [disabled]="medicalHistoryForm.invalid || loadingHistory" (click)="saveMedicalHistory()">
    Guardar Historial
  </button>
</div>
</form>

